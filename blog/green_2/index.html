<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Harry Aquije Ballon">
<meta name="dcterms.date" content="2025-12-17">

<title>What Does Green Access Look Like in Your City? - Part 2 – Harry Aquije Ballon</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-25b690a7babd8f4636ecd78d08a95595.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-date','listing-title','listing-conference','listing-categories',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: [],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Harry Aquije Ballon</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../talks/index.html"> <i class="bi bi-megaphone" role="img">
</i> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../now/index.html"> 
<span class="menu-text">Now</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">What Does Green Access Look Like in Your City? - Part 2</h1>
            <div class="quarto-categories">
                  <div class="quarto-category">geocomputation</div>
                  <div class="quarto-category">urban-policy</div>
                  <div class="quarto-category">green</div>
                  <div class="quarto-category">sustainability</div>
                  <div class="quarto-category">R</div>
              </div>
    </div>
  </div>

  <div class="quarto-title-meta">
          <div>
        <div class="quarto-title-meta-heading">Authors</div>
        <div class="quarto-title-meta-contents">
                      <p>Harry Aquije Ballon</p>
                  </div>
      </div>
        
          <div>
        <div class="quarto-title-meta-heading">Event Date</div>
        <div class="quarto-title-meta-contents">
          <p class="date">2025-12-17</p>
        </div>
      </div>
      </div>
</header>


<hr>
<section id="another-tale-of-two-cities-when-green-isnt-for-people-seville-and-arequipa" class="level2">
<h2 class="anchored" data-anchor-id="another-tale-of-two-cities-when-green-isnt-for-people-seville-and-arequipa">Another Tale of Two Cities: When Green Isn’t for People: Seville and Arequipa</h2>
<p>In the first entry of this series, I compared green space access in London and Lima, highlighting how historical planning decisions and institutional capacity shape urban access to nature. In this second instalment, I turn to two very different cities: Seville, Spain, and Arequipa, Peru.</p>
<p>At first glance, both cities appear relatively “green” when viewed from above. Yet a closer look reveals a crucial distinction: not all green space is green space for people. Fields, farms, and cultivated land may dominate the urban landscape in some cities, while accessible parks and recreational areas remain scarce.</p>
<p>This article explores that distinction by quantifying and mapping green areas in Seville and Arequipa, with particular attention to who green space is actually for.</p>
</section>
<section id="why-seville-and-arequipa" class="level2">
<h2 class="anchored" data-anchor-id="why-seville-and-arequipa">Why Seville and Arequipa?</h2>
<p>Seville and Arequipa are not obvious twins. They differ in income levels, climate, and institutional context. Yet they share several characteristics that make comparison meaningful:</p>
<ul>
<li>Both are historical regional capitals, not national capitals</li>
<li>Both have compact urban cores surrounded by peri-urban land</li>
<li>Both experience hot climates, where green space plays a critical role in thermal comfort and public health</li>
<li>Both are cities where urban expansion has increasingly collided with environmental constraints</li>
</ul>
<p>Most importantly, they illustrate two very different models of how “green” land is distributed within metropolitan boundaries. Moreover, as someone born and raised in Arequipa, this analysis reflects a personal interest in better understanding access to green areas in the city. Table 1 presents the main demographic characteristics.</p>
<div class="table-captioned">
<p><em>Table 1: Demographic Comparison</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 45%">
<col style="width: 25%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th>Dimension</th>
<th>Seville Municipality</th>
<th>Metropolitan Arequipa</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Area</td>
<td>140 km²</td>
<td>680 km²</td>
</tr>
<tr class="even">
<td>Population (2024)</td>
<td>690,000</td>
<td>1,000,000</td>
</tr>
<tr class="odd">
<td>GDP per capita, PPP (2024)</td>
<td>$57,000</td>
<td>$17,800</td>
</tr>
</tbody>
</table>
<p><span style="font-size:0.8em;"> Notes: The GDP per capita (PPP, current international $) figures correspond to Spain for Seville and Peru for Metropolitan Arequipa.<br>
Source: Author’s analysis, World Bank (2024); Wikipedia. </span></p>
</div>
</section>
<section id="data-and-methodology" class="level2">
<h2 class="anchored" data-anchor-id="data-and-methodology">Data and Methodology</h2>
<p>The analysis uses OpenStreetMap (OSM) polygon data to identify green areas, spatially clipped to official administrative boundaries:</p>
<ul>
<li>Seville: municipal boundary from Spain’s National Geographic Institute (CNIG)</li>
<li>Arequipa: metropolitan districts from Peru’s National Institute of Statistics and Informatics (INEI)</li>
</ul>
<p>For both cities, green areas were extracted using consistent OSM tags (parks, gardens, forests, grassland, etc.). However, for Arequipa, the analysis goes one step further by separating green land into two conceptually distinct categories:</p>
<ol type="1">
<li>Agricultural green</li>
</ol>
<ul>
<li>Farmland</li>
<li>Orchards</li>
<li>Plant nurseries</li>
<li>Other cultivated land</li>
</ul>
<ol start="2" type="1">
<li>Urban green (parks &amp; recreation)</li>
</ol>
<ul>
<li>Public parks and gardens</li>
<li>Sports pitches</li>
<li>Recreational grounds</li>
<li>Natural urban vegetation</li>
</ul>
<p>All geometries were re-projected into appropriate equal-area coordinate systems before computing surface areas and shares.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="seville-green-space-as-urban-infrastructure" class="level3">
<h3 class="anchored">Seville: Green Space as Urban Infrastructure</h3>
<p>Seville shows a relatively high and coherent level of public green space coverage at <strong>18%</strong>. Parks, gardens, and recreational areas are well integrated into the urban fabric, with large continuous green spaces such as Parque de María Luisa complemented by smaller neighbourhood parks.</p>
<p>While green space distribution is not perfectly uniform, the dominant pattern shows that in Seville, most green land within the city boundary is intended for public use. This makes Seville a useful benchmark for what green access can look like in a consolidated European city with decades of planned green infrastructure investment.</p>
<div class="talk-figure">
<div class="figure-title">

</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="gsevilla_v2.png" class="talk-image img-fluid figure-img"></p>
<figcaption>Source: Map data from OpenStreetMap, ONS, INEI</figcaption>
</figure>
</div>
<section id="arequipa-green-but-not-green-for-people" class="level3">
<h3 class="anchored">Arequipa: Green, but Not Green for People</h3>
<p>At the scale of Arequipa metropolitan area, the city appears surprisingly green. However, once agricultural land is separated from recreational green space, a very different picture emerges.</p>
<div class="table-captioned">
<p><em>Table 2: Composition of green areas in Arequipa metropolitan area</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 19%">
<col style="width: 21%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Type of green area</th>
<th>Area (km²)</th>
<th>Share of total green</th>
<th>Share of city area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Agricultural green</td>
<td>59</td>
<td>85%</td>
<td>8.7%</td>
</tr>
<tr class="even">
<td>Urban green (parks &amp; recreation)</td>
<td>10</td>
<td>15%</td>
<td>1.5%</td>
</tr>
</tbody>
</table>
<p><span style="font-size:0.8em;"> Source: Author’s analysis based on OSM and INEI </span></p>
</div>
<p>In total, green areas account for about <strong>10%</strong> of Arequipa Metropolitan’s land area. Yet only <strong>1.5%</strong> of the city consists of parks and recreational green spaces.</p>
<p>The vast majority of green land is agricultural — concentrated along the city’s periphery and river valleys — and is largely inaccessible to residents for daily recreation.</p>
<p>This distinction is critical. From a satellite or statistical perspective, Arequipa may appear moderately green. From the perspective of a resident seeking shade, leisure, or respite from heat, the city is far less so.</p>
<p>To make this distinction visible, the analysis produces a single map for Arequipa with three elements:</p>
<ul>
<li>Metropolitan boundary (white outline)</li>
<li>Agricultural green (light green)</li>
<li>Urban green spaces (dark green)</li>
</ul>
<p>We can see that green clusters are not where most people live — and not where they can relax. By contrast, Seville’s map shows green areas distributed as functional urban infrastructure rather than residual land.</p>
<div class="talk-figure">
<div class="figure-title">

</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="garequipa_v2.png" class="talk-image img-fluid figure-img"></p>
<figcaption>Source: Map data from OpenStreetMap, ONS, INEI</figcaption>
</figure>
</div>
<section id="key-insights" class="level2">
<h2 class="anchored" data-anchor-id="key-insights">Key Insights</h2>
<ol type="1">
<li><strong>Green coverage alone is a misleading metric.</strong> Counting hectares without distinguishing land use overstates access in cities where agriculture dominates.</li>
<li><strong>Arequipa’s green space is productive, not recreational.</strong> Agricultural land plays an important economic and environmental role — but it does not substitute for parks.</li>
<li><strong>Urban form matters.</strong> Seville’s green spaces are embedded within neighbourhoods; Arequipa’s are largely peripheral.</li>
<li><strong>Heat and climate risks amplify the problem.</strong> In hot, high-altitude cities like Arequipa, the absence of accessible green areas has direct implications for health and liveability.</li>
</ol>
</section>
<section id="policy-implications" class="level2">
<h2 class="anchored" data-anchor-id="policy-implications">Policy Implications</h2>
<p>The policy takeaway is not that agricultural land should be replaced — quite the opposite.</p>
<p><strong>For Arequipa</strong></p>
<ul>
<li>Protect agricultural green areas as environmental and cultural assets</li>
<li>Explicitly plan for recreational green space, especially in dense districts</li>
<li>Prioritise pocket parks, shaded corridors, river-adjacent public greenways</li>
</ul>
<p><strong>For Seville</strong></p>
<ul>
<li>Maintain investment in public green infrastructure</li>
<li>Focus on connectivity between green spaces</li>
<li>Promote equitable access across neighbourhoods</li>
<li>Prioritise heat-resilient urban design as temperature rise</li>
</ul>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Seville and Arequipa illustrate a fundamental lesson in urban planning: Green space is not just about land cover, it is about access, purpose, and people. Cities can appear green while remaining inhospitable to daily life. Measuring and mapping green areas with attention to how they are used reveals a more honest picture and a clearer path for policy.</p>
<p>In the end, the relevant question is not “How green is your city?” It is: “How green is your city for the people who live there?”</p>
</section>
<section id="interactive-maps" class="level2">
<h2 class="anchored" data-anchor-id="interactive-maps">Interactive Maps</h2>
<section id="interactive-map-for-seville" class="level3">
<h3 class="anchored" data-anchor-id="interactive-map-for-seville">Interactive map for Seville</h3>
<p>The interactive map below displays the share of green areas in the Seville municipality. It was not possible to obtain the district level geometries from the Spanish National Geographic Institute.</p>
<iframe src="sevilla_green_share_mun.html" width="100%" height="650px" style="border:none;" title="Interactive map of green area share by municipality in Seville">
</iframe>
<p><span style="font-size:0.9em;"> <em>Source: OpenStreetMap, CNIG. Author’s analysis.</em> </span> —</p>
</section>
<section id="interactive-map-for-metropolitan-arequipa" class="level3">
<h3 class="anchored" data-anchor-id="interactive-map-for-metropolitan-arequipa">Interactive map for Metropolitan Arequipa</h3>
<p>This interactive map shows the proportion of green areas by district in Arequipa metropolitan area, including agriculture and recreational green areas.</p>
<iframe src="arequipa_green_share_district.html" width="100%" height="650px" style="border:none;" title="Interactive map of green area share by district in Metropolitan Arequipa">
</iframe>
<p><span style="font-size:0.9em;"> <em>Source: OpenStreetMap, INEI. Author’s analysis.</em> </span></p>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Instituto Geográfico Nacional (CNIG). (2025). <em>Límites municipales, provinciales y autonómicos</em>. https://centrodedescargas.cnig.es/CentroDescargas/informacion-geografica-referencia<br>
</li>
<li>Instituto Nacional de Estadística e Informática (INEI). (2023). <em>Límites distritales del Perú</em> (District boundaries).<br>
</li>
<li>OpenStreetMap contributors. (2025). <em>OpenStreetMap planet dump</em>. Available under the Open Database License (ODbL). https://www.openstreetmap.org/copyright</li>
<li>World Bank. (2024). World Development Indicators.</li>
</ul>
<p><strong>Data licences &amp; notes:</strong><br>
- OpenStreetMap data are provided under the <em>Open Database License (ODbL)</em>. Users may copy, modify, and publish OSM-derived data provided derivative data are shared under the same licence and attribution is given.</p>
<p><strong>Code &amp; reproducibility:</strong><br>
All analysis code, processing scripts and the instructions to reproduce the maps are available on GitHub: <a href="https://github.com/harryaquije/green_cities_part_2">green_cities_part_2 repository</a>.</p>



</section>
</div>
</section>
</div>
</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">No matching items</div>
</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/harryaquije\.github\.io\/harryaquijeballon\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>